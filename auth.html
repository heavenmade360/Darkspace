<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>FocusFlow — Sign In</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    body { background: var(--ink); min-height: 100vh; display: flex; flex-direction: column; }

    .auth-layout {
      flex: 1; display: grid;
      grid-template-columns: 1fr 1fr;
      min-height: 100vh;
    }

    /* ── LEFT PANEL ── */
    .auth-panel {
      background: var(--ink);
      padding: clamp(40px,6vw,72px);
      display: flex; flex-direction: column;
      position: relative; overflow: hidden;
    }
    .auth-panel::before {
      content: '';
      position: absolute; inset: 0;
      background:
        radial-gradient(ellipse 80% 60% at 30% 80%, rgba(249,115,22,0.12) 0%, transparent 60%),
        radial-gradient(ellipse 50% 40% at 70% 20%, rgba(249,115,22,0.06) 0%, transparent 60%);
      pointer-events: none;
    }

    .auth-panel-logo { position: relative; z-index: 1; margin-bottom: auto; }
    .auth-panel-logo .nav-logo { color: var(--bg); }

    .auth-panel-body { position: relative; z-index: 1; margin: auto 0; }
    .auth-panel-body h1 { color: var(--bg); margin-bottom: 20px; }
    .auth-panel-body h1 em { color: var(--accent); }
    .auth-panel-body p { color: rgba(255,255,255,0.4); max-width: 320px; line-height: 1.7; }

    .auth-panel-stats {
      position: relative; z-index: 1;
      display: flex; gap: 36px;
      padding-top: 36px;
      border-top: 1px solid rgba(255,255,255,0.08);
      margin-top: 60px;
    }
    .auth-panel-stat h3 { font-family: var(--font-serif); font-size: 2rem; letter-spacing: -1px; color: var(--bg); margin-bottom: 4px; }
    .auth-panel-stat p { font-size: 0.78rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: rgba(255,255,255,0.3); }

    /* ── RIGHT / FORM PANEL ── */
    .auth-form-panel {
      background: var(--bg);
      display: flex; align-items: center; justify-content: center;
      padding: clamp(32px,5vw,64px) clamp(24px,5vw,56px);
    }
    .auth-form-box { width: 100%; max-width: 400px; }

    /* Tab switcher */
    .auth-tabs {
      display: grid; grid-template-columns: 1fr 1fr;
      background: var(--bg-2);
      border-radius: var(--r-lg);
      padding: 4px;
      margin-bottom: 36px;
    }
    .auth-tab {
      padding: 11px;
      border-radius: 10px;
      font-size: 0.875rem; font-weight: 700;
      color: var(--ink-3);
      text-align: center;
      cursor: pointer;
      transition: all var(--t-base) var(--ease);
    }
    .auth-tab.active {
      background: var(--surface);
      color: var(--ink);
      box-shadow: var(--shadow-sm);
    }

    .auth-heading { margin-bottom: 6px; font-family: var(--font-serif); font-size: 1.9rem; letter-spacing: -0.5px; }
    .auth-subheading { color: var(--ink-3); font-size: 0.9rem; margin-bottom: 32px; }

    /* Form */
    .auth-form { display: flex; flex-direction: column; gap: 16px; }
    .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

    .auth-forgot {
      font-size: 0.8125rem; font-weight: 600; color: var(--accent);
      text-align: right; display: block; margin-top: -6px;
      transition: opacity 0.15s;
    }
    .auth-forgot:hover { opacity: 0.75; }

    .auth-divider {
      display: flex; align-items: center; gap: 14px;
      font-size: 0.78rem; font-weight: 600; color: var(--ink-4); margin: 4px 0;
    }
    .auth-divider::before,.auth-divider::after { content:''; flex:1; height:1px; background:var(--border); }

    .btn-google {
      display: flex; align-items: center; justify-content: center; gap: 10px;
      width: 100%; padding: 12px;
      background: var(--surface); border: 1.5px solid var(--border-md);
      border-radius: var(--r-lg);
      font-size: 0.9rem; font-weight: 700; color: var(--ink);
      transition: all var(--t-base) var(--ease); cursor: pointer;
    }
    .btn-google:hover { border-color: var(--ink-3); box-shadow: var(--shadow-sm); }

    .auth-footer-note {
      text-align: center;
      font-size: 0.8rem;
      color: var(--ink-3);
      margin-top: 24px;
    }
    .auth-footer-note a { color: var(--accent); font-weight: 700; }

    /* Password strength */
    .strength-bar { display: flex; gap: 4px; margin-top: 8px; }
    .strength-seg { height: 3px; flex: 1; border-radius: 2px; background: var(--bg-2); transition: background 0.3s; }
    .strength-seg.weak { background: var(--red); }
    .strength-seg.fair { background: #f59e0b; }
    .strength-seg.good { background: var(--green); }
    .strength-label { font-size: 0.75rem; color: var(--ink-3); margin-top: 4px; }

    /* Loading overlay */
    .auth-loading { display: none; position: absolute; inset: 0; background: rgba(250,250,248,0.8); align-items: center; justify-content: center; z-index: 10; border-radius: var(--r-2xl); }
    .auth-loading.show { display: flex; }
    .spinner { width: 32px; height: 32px; border: 3px solid var(--border-md); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.7s linear infinite; }

    /* Back to home */
    .back-home { display: flex; align-items: center; gap: 6px; color: rgba(255,255,255,0.35); font-size: 0.875rem; font-weight: 600; transition: color 0.2s; text-decoration: none; }
    .back-home:hover { color: rgba(255,255,255,0.7); }

    @media(max-width:768px) {
      .auth-layout { grid-template-columns: 1fr; }
      .auth-panel { display: none; }
      .auth-form-panel { background: var(--bg); padding: 40px 24px; min-height: 100vh; align-items: flex-start; padding-top: 80px; }
      body::before { content: ''; position: fixed; top: 0; left: 0; right: 0; height: var(--nav-h); background: var(--ink); z-index: 100; }
      body::after { content: 'FocusFlow'; position: fixed; top: 0; left: 0; right: 0; height: var(--nav-h); display: flex; align-items: center; padding-left: 24px; font-family: var(--font-serif); font-size: 1.25rem; color: var(--bg); z-index: 101; }
    }
  </style>
</head>
<body>

<div id="toast">
  <svg class="toast-icon" viewBox="0 0 20 20" fill="none" stroke="var(--accent)" stroke-width="2.5" stroke-linecap="round"><polyline points="4 10 8 14 16 6"/></svg>
  <span class="toast-msg"></span>
</div>

<div class="auth-layout">

  <!-- LEFT: Brand panel -->
  <div class="auth-panel">
    <div class="auth-panel-logo">
      <a href="index.html" class="nav-logo" style="color:var(--bg)">
        FocusFlow<span class="nav-logo-dot"></span>
      </a>
    </div>

    <div class="auth-panel-body">
      <h1 class="t-h1">Your most<br>focused days<br><em>start here.</em></h1>
      <p class="t-body">Join 150,000+ professionals, students, and founders who've made deep work a daily habit.</p>
    </div>

    <div class="auth-panel-stats">
      <div class="auth-panel-stat"><h3>98%</h3><p>Focus rate</p></div>
      <div class="auth-panel-stat"><h3>4.9★</h3><p>App rating</p></div>
      <div class="auth-panel-stat"><h3>Free</h3><p>To start</p></div>
    </div>

    <a href="index.html" class="back-home" style="margin-top:40px;position:relative;z-index:1">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="15 18 9 12 15 6"/></svg>
      Back to home
    </a>
  </div>

  <!-- RIGHT: Form panel -->
  <div class="auth-form-panel">
    <div class="auth-form-box">

      <!-- Tabs -->
      <div class="auth-tabs" role="tablist">
        <div class="auth-tab active" role="tab" aria-selected="true" onclick="switchTab('signin')" id="tab-signin">Sign in</div>
        <div class="auth-tab" role="tab" aria-selected="false" onclick="switchTab('signup')" id="tab-signup">Create account</div>
      </div>

      <!-- SIGN IN -->
      <div id="panel-signin">
        <div class="auth-heading">Welcome back.</div>
        <div class="auth-subheading">Enter your credentials to continue.</div>

        <form class="auth-form" id="form-signin" onsubmit="handleSignIn(event)" novalidate>
          <div class="field" id="f-si-email">
            <label for="si-email">Email address</label>
            <input type="email" id="si-email" placeholder="you@example.com" autocomplete="email" required/>
            <span class="field-error">Please enter a valid email.</span>
          </div>
          <div class="field" id="f-si-pass">
            <label for="si-pass">Password</label>
            <input type="password" id="si-pass" placeholder="••••••••" autocomplete="current-password" required/>
            <span class="field-error">Password is required.</span>
          </div>
          <a href="forgot.html" class="auth-forgot">Forgot password?</a>
          <button type="submit" class="btn btn-primary btn-full btn-lg" id="btn-signin">
            Sign in to FocusFlow
          </button>
        </form>

        <div class="auth-divider" style="margin:20px 0">or</div>

        <button class="btn-google" onclick="handleGoogleAuth()">
          <svg width="18" height="18" viewBox="0 0 24 24">
            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          Continue with Google
        </button>

        <div class="auth-footer-note">
          Don't have an account? <a href="#" onclick="switchTab('signup');return false">Create one free</a>
        </div>
      </div>

      <!-- SIGN UP -->
      <div id="panel-signup" style="display:none">
        <div class="auth-heading">Start for free.</div>
        <div class="auth-subheading">No credit card. Up and running in 30 seconds.</div>

        <form class="auth-form" id="form-signup" onsubmit="handleSignUp(event)" novalidate>
          <div class="field-row">
            <div class="field" id="f-su-fname">
              <label for="su-fname">First name</label>
              <input type="text" id="su-fname" placeholder="Alex" autocomplete="given-name" required/>
              <span class="field-error">Required.</span>
            </div>
            <div class="field" id="f-su-lname">
              <label for="su-lname">Last name</label>
              <input type="text" id="su-lname" placeholder="Chen" autocomplete="family-name"/>
            </div>
          </div>
          <div class="field" id="f-su-email">
            <label for="su-email">Email address</label>
            <input type="email" id="su-email" placeholder="you@example.com" autocomplete="email" required/>
            <span class="field-error">Please enter a valid email.</span>
          </div>
          <div class="field" id="f-su-pass">
            <label for="su-pass">Password</label>
            <input type="password" id="su-pass" placeholder="Min. 8 characters" autocomplete="new-password" required oninput="checkStrength(this.value)"/>
            <span class="field-error">Minimum 8 characters.</span>
            <div class="strength-bar" id="strength-bar">
              <div class="strength-seg" id="ss1"></div>
              <div class="strength-seg" id="ss2"></div>
              <div class="strength-seg" id="ss3"></div>
              <div class="strength-seg" id="ss4"></div>
            </div>
            <div class="strength-label" id="strength-label"></div>
          </div>
          <button type="submit" class="btn btn-primary btn-full btn-lg" id="btn-signup">
            Create my account →
          </button>
          <p style="font-size:0.78rem;color:var(--ink-3);text-align:center;margin-top:-4px">
            By signing up you agree to our <a href="#" style="color:var(--ink-2)">Terms</a> &amp; <a href="#" style="color:var(--ink-2)">Privacy Policy</a>.
          </p>
        </form>

        <div class="auth-divider" style="margin:20px 0">or</div>

        <button class="btn-google" onclick="handleGoogleAuth()">
          <svg width="18" height="18" viewBox="0 0 24 24">
            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          Continue with Google
        </button>

        <div class="auth-footer-note">
          Already have an account? <a href="#" onclick="switchTab('signin');return false">Sign in</a>
        </div>
      </div>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="utils.js"></script>
<script>
  // ── Check hash for #signup ──
  if (window.location.hash === '#signup') switchTab('signup');

  function switchTab(tab) {
    const isSignin = tab === 'signin';
    document.getElementById('tab-signin').classList.toggle('active', isSignin);
    document.getElementById('tab-signup').classList.toggle('active', !isSignin);
    document.getElementById('panel-signin').style.display = isSignin ? '' : 'none';
    document.getElementById('panel-signup').style.display = isSignin ? 'none' : '';
  }

  // ── Password strength ──
  function checkStrength(val) {
    const segs = ['ss1','ss2','ss3','ss4'].map(id => document.getElementById(id));
    const lbl = document.getElementById('strength-label');
    segs.forEach(s => { s.className = 'strength-seg'; });
    if (!val) { lbl.textContent = ''; return; }
    let score = 0;
    if (val.length >= 8) score++;
    if (/[A-Z]/.test(val)) score++;
    if (/[0-9]/.test(val)) score++;
    if (/[^A-Za-z0-9]/.test(val)) score++;
    const labels = ['','Weak','Fair','Good','Strong'];
    const cls = ['','weak','fair','good','good'];
    for (let i = 0; i < score; i++) segs[i].classList.add(cls[score]);
    lbl.textContent = score > 0 ? labels[score] : '';
    lbl.style.color = score <= 1 ? 'var(--red)' : score === 2 ? '#f59e0b' : 'var(--green)';
  }

  // ── Sign In ──
  async function handleSignIn(e) {
    e.preventDefault();
    const email = document.getElementById('si-email').value.trim();
    const pass  = document.getElementById('si-pass').value;
    const btn   = document.getElementById('btn-signin');

    let valid = true;
    const ef = document.getElementById('f-si-email');
    const pf = document.getElementById('f-si-pass');
    ef.classList.toggle('error', !validateEmail(email)); if (!validateEmail(email)) valid = false;
    pf.classList.toggle('error', !pass); if (!pass) valid = false;
    if (!valid) return;

    setLoading(btn, true);

    // ── SUPABASE: Replace demo logic below with real call ──
    // const sb = getSupabase();
    // const { data, error } = await sb.auth.signInWithPassword({ email, password: pass });
    // if (error) { showToast(error.message, 'error'); setLoading(btn, false); return; }
    // window.location.href = 'dashboard.html';

    // Demo fallback:
    await new Promise(r => setTimeout(r, 1200));
    setLoading(btn, false);
    window.location.href = 'dashboard.html';
  }

  // ── Sign Up ──
  async function handleSignUp(e) {
    e.preventDefault();
    const fname = document.getElementById('su-fname').value.trim();
    const email = document.getElementById('su-email').value.trim();
    const pass  = document.getElementById('su-pass').value;
    const btn   = document.getElementById('btn-signup');

    let valid = true;
    const fnf = document.getElementById('f-su-fname');
    const ef  = document.getElementById('f-su-email');
    const pf  = document.getElementById('f-su-pass');
    fnf.classList.toggle('error', !fname); if (!fname) valid = false;
    ef.classList.toggle('error', !validateEmail(email)); if (!validateEmail(email)) valid = false;
    pf.classList.toggle('error', pass.length < 8); if (pass.length < 8) valid = false;
    if (!valid) return;

    setLoading(btn, true);

    // ── SUPABASE ──
    // const sb = getSupabase();
    // const { data, error } = await sb.auth.signUp({
    //   email, password: pass,
    //   options: { data: { full_name: fname + ' ' + document.getElementById('su-lname').value.trim() } }
    // });
    // if (error) { showToast(error.message, 'error'); setLoading(btn, false); return; }
    // showToast('Check your email to confirm your account!');
    // window.location.href = 'dashboard.html';

    // Demo fallback:
    await new Promise(r => setTimeout(r, 1200));
    setLoading(btn, false);
    window.location.href = 'dashboard.html';
  }

  // ── Google OAuth ──
  async function handleGoogleAuth() {
    // const sb = getSupabase();
    // await sb.auth.signInWithOAuth({ provider: 'google', options: { redirectTo: window.location.origin + '/dashboard.html' } });
    showToast('Google sign-in — wire up Supabase OAuth to activate!');
  }

  function validateEmail(v) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }
  function setLoading(btn, on) {
    if (on) {
      btn._label = btn.innerHTML;
      btn.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="animation:spin 0.75s linear infinite"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>`;
      btn.disabled = true;
    } else {
      btn.innerHTML = btn._label;
      btn.disabled = false;
    }
  }
</script>
</body>
</html>
